{% extends "base.html" %}

{% block content %}
<section  id="koszyk" style="padding-top: 90px"></section>

 <section>
   <div class="container">
     <div id="time_info" style="padding:20px 0; font-weight: 600; font-size:20px;"></div>
   <div class="row">
     <form action="http://localhost:8000/orders/potwierdz-zamowienie/" method="post">
    <table class="table table-hover table-bordered text-center">
      <tr class="text-center">
        <th>Ilość</th>
        <th>Kanapka</th>
        <th>Cena</th>
      </tr>
      {% for item in order.get_order %}
        {% if not item.is_ordered %}
        <tr>
          <td>
            <input value={{item.quantity}}>
            <a href="{% url 'orders:update_quantity' item.id item.quantity %}" class="btn btn-primary update-quantity">Aktualizuj</a>
          </td>
          <td>
            {{ item.sandwich.name }}
            <span class="pull-right">
              <a href="{% url 'orders:delete_sandwich' item.id %}" data-balloon="Usuń kanapkę z koszyka" class="text-danger">
                <i class="fas fa-trash"></i>
              </a>
            </span>
          </td>
          <td>{{ item.sandwich.price }} PLN</td>
        </tr>
        {% endif %}
      {% empty %}
        <tr>
          <td colspan= 3>Uuu... dzisiaj na głodnego?</td>
        </tr>
      {% endfor %}
      <tr>
        {% if order.get_total %}
        <td colspan=2>
          <strong class="pull-right">W sumie:</strong>
        </td>
        
        <td colspan=1>
          <strong>{{ order.get_total }} PLN</strong>
        </td>
        {% endif %}
      </tr>
      <tr>
        <td>
        <textarea rows="4" cols="50" name="order_remarks">Uwagi do zamówienia.</textarea>
        </td>
      </tr>
      <tr>
        <td colspan=2 >
          <a href="{% url 'sandwiches:sandwiches' %}" class="btn btn-warning pull-left">
            Wróć do wyboru kanapek
          </a> 
        </td>
        <td colspan=1>
          {% if order.get_order %}

              {% csrf_token %}
              <input class="btn btn-primary pull-right"
                   type="submit"
                   title="Zamów"
                   value="Zamów"
                   style="margin-bottom:15px">

          {% endif %}
        </td>
      </tr>
    </table>
     </form>
   </div>
   </div>
 </section>
{% endblock %}


{% block script %}
<script>
$(document).ready (function () {
    $(".update-quantity").one ('click', function (e) {
        var url_quantity =  $(this).attr('href');
        var regex_quantity = /(\d+)(?!.*\d)/;
        this.href = url_quantity.replace(regex_quantity, $(this).siblings('input').val())
    });

    var x = setInterval(function() {

  var distance = new Date().getTime();
  var now = new Date();
  var hour = now.getHours();
  var minutes = now.getMinutes();
  var seconds = now.getSeconds();

  if (hour > 0 && hour < 8) {$( "#time_info" ).text("Twoja kanapka dojedzie dziś w godzinach 10:00-12:00.")}
  else if (hour>8 && hour < 9) {$( "#time_info" ).text("Jeśli zamówisz kanapkę w ciągu " + (60 - minutes) + " minut, kanapka dojedzie dziś w godzinach 10:00-12:00.")}
  else {$( "#time_info" ).text("Twoja kanapka dojedzie jutro w godzinach 10:00-12:00.")}

  if (distance < 0) {
    clearInterval(x);
  }
}, 1000);
});
</script>
{% endblock script %}